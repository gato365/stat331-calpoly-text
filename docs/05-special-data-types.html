<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Stat 331/531 Statistical Computing with R - 5&nbsp; Special Data Types</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./06-shiny.html" rel="next">
<link href="./04-data-joins-and-transformations.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><link rel="stylesheet" href="style.css">
</head>
<body class="nav-sidebar floating slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./05-special-data-types.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Special Data Types</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Stat 331/531 Statistical Computing with R</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/earobinson95/stat331-calpoly-text" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
<li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=%7Curl%7C">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=%7Curl%7C">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=%7Curl%7C">
              <i class="bi bi-bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
</div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-prereading.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Pre-reading</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-tidy-data-and-basics-of-graphics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Tidy Data &amp; Basics of Graphics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-data-cleaning-and-manipulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data Cleaning and Manipulation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-data-joins-and-transformations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data Joins and Transformations</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-special-data-types.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Special Data Types</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-shiny.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Shiny (a web application)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Writing Functions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-functional-programming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Functional Programming</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-version-control.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Version Control</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-predictive-checks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Predictive Checks</span></span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#ch5-objectives" id="toc-ch5-objectives" class="nav-link active" data-scroll-target="#ch5-objectives">Objectives</a></li>
  <li><a href="#ch5-checkins" id="toc-ch5-checkins" class="nav-link" data-scroll-target="#ch5-checkins">Check-ins</a></li>
  <li>
<a href="#factors-with-forcats" id="toc-factors-with-forcats" class="nav-link" data-scroll-target="#factors-with-forcats"><span class="header-section-number">5.1</span> Factors with <code>forcats</code></a>
  <ul class="collapse">
<li><a href="#forcats" id="toc-forcats" class="nav-link" data-scroll-target="#forcats"><code>forcats</code></a></li>
  </ul>
</li>
  <li><a href="#checkin5-1" id="toc-checkin5-1" class="nav-link" data-scroll-target="#checkin5-1">Check-in 5.1: Functions from <code>forcats</code></a></li>
  <li>
<a href="#string-operations-with-stringr" id="toc-string-operations-with-stringr" class="nav-link" data-scroll-target="#string-operations-with-stringr"><span class="header-section-number">5.2</span> String Operations with <code>stringr</code></a>
  <ul class="collapse">
<li><a href="#stringr" id="toc-stringr" class="nav-link" data-scroll-target="#stringr"><code>stringr</code></a></li>
  <li><a href="#regular-expressions" id="toc-regular-expressions" class="nav-link" data-scroll-target="#regular-expressions"><span class="header-section-number">5.2.1</span> Regular Expressions</a></li>
  </ul>
</li>
  <li><a href="#checkin5-2" id="toc-checkin5-2" class="nav-link" data-scroll-target="#checkin5-2">Check-in 5.2: Functions from <code>stringr</code></a></li>
  <li>
<a href="#dates-times-with-lubridate" id="toc-dates-times-with-lubridate" class="nav-link" data-scroll-target="#dates-times-with-lubridate"><span class="header-section-number">5.3</span> Dates &amp; Times with <code>lubridate</code></a>
  <ul class="collapse">
<li><a href="#learn-more-about-dates-and-times" id="toc-learn-more-about-dates-and-times" class="nav-link" data-scroll-target="#learn-more-about-dates-and-times">Learn more about dates and times</a></li>
  </ul>
</li>
  <li><a href="#checkin5-3" id="toc-checkin5-3" class="nav-link" data-scroll-target="#checkin5-3">Check-in 5.3: Functions from <code>lubridate</code></a></li>
  <li>
<a href="#practice-activities" id="toc-practice-activities" class="nav-link" data-scroll-target="#practice-activities">Practice Activities</a>
  <ul class="collapse">
<li><a href="#pa-5.1-zodiac-killer" id="toc-pa-5.1-zodiac-killer" class="nav-link" data-scroll-target="#pa-5.1-zodiac-killer">PA 5.1: Zodiac Killer</a></li>
  <li><a href="#pa-5.2-scrambled-message" id="toc-pa-5.2-scrambled-message" class="nav-link" data-scroll-target="#pa-5.2-scrambled-message">PA 5.2: Scrambled Message</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/earobinson95/stat331-calpoly-text/edit/main/05-special-data-types.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">
<span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Special Data Types</span>
</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><p><svg aria-hidden="true" role="img" viewbox="0 0 576 512" style="height:1em;width:1.12em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M249.6 471.5c10.8 3.8 22.4-4.1 22.4-15.5V78.6c0-4.2-1.6-8.4-5-11C247.4 52 202.4 32 144 32C93.5 32 46.3 45.3 18.1 56.1C6.8 60.5 0 71.7 0 83.8V454.1c0 11.9 12.8 20.2 24.1 16.5C55.6 460.1 105.5 448 144 448c33.9 0 79 14 105.6 23.5zm76.8 0C353 462 398.1 448 432 448c38.5 0 88.4 12.1 119.9 22.6c11.3 3.8 24.1-4.6 24.1-16.5V83.8c0-12.1-6.8-23.3-18.1-27.6C529.7 45.3 482.5 32 432 32c-58.4 0-103.4 20-123 35.6c-3.3 2.6-5 6.8-5 11V456c0 11.4 11.7 19.3 22.4 15.5z"></path></svg> Reading: 21 minute(s) at 200 WPM + <a href="https://r4ds.hadley.nz/">r4ds</a> required readings</p>
<p><svg aria-hidden="true" role="img" viewbox="0 0 576 512" style="height:1em;width:1.12em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M0 128C0 92.7 28.7 64 64 64H320c35.3 0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V128zM559.1 99.8c10.4 5.6 16.9 16.4 16.9 28.2V384c0 11.8-6.5 22.6-16.9 28.2s-23 5-32.9-1.6l-96-64L416 337.1V320 192 174.9l14.2-9.5 96-64c9.8-6.5 22.4-7.2 32.9-1.6z"></path></svg> Videos: 32 minutes</p>
<section id="ch5-objectives" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="ch5-objectives">Objectives</h2>
<p>This chapter is heavily outsourced to <a href="https://r4ds.hadley.nz/">r4ds</a> as they do a much better job at providing examples and covering the extensive functionality of each of the packages than I myself would ever be able to.</p>
<ul>
<li>Use <code>forcats</code> to reorder and relabel factor variables in data cleaning steps and data visualizations.</li>
<li>Clean and extract information from character strings using <code>stringr</code>
</li>
<li>Work with date and time variables using <code>lubridate</code>
</li>
</ul>
<p><br></p>
</section><section id="ch5-checkins" class="level2 unnumbered check-in"><h2 class="unnumbered anchored" data-anchor-id="ch5-checkins">Check-ins</h2>
<p>There are three check-ins for this week:</p>
<ul>
<li><a href="#checkin5-1">Check-in 5.1: Functions from <code>forcats</code></a></li>
<li><a href="#checkin5-2">Check-in 5.2: Functions from <code>stringr</code></a></li>
<li><a href="#checkin5-3">Check-in 5.3: Functions from <code>lubridate</code></a></li>
</ul>
<p><em>Feel free to share answers with your classmates in the Discord server, to make sure you understand. Check-ins are meant for you to learn and practice!</em></p>
</section><section id="factors-with-forcats" class="level2 page-columns page-full" data-number="5.1"><h2 data-number="5.1" class="anchored" data-anchor-id="factors-with-forcats">
<span class="header-section-number">5.1</span> Factors with <code>forcats</code>
</h2>
<p>We have been floating around the idea of <em>factor</em> data types. In this chapter, we will formally define factors and why they are needed for data visualization and analysis. We will then learn useful functions for working with factors in our data cleaning steps.</p>

<div class="no-row-height column-margin column-container"><div class="">
<div class="youtube-video-container">
<iframe width="100%" height="auto" src="https://www.youtube.com/embed/dAiSYli7tVg" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="">
</iframe>
</div>
</div></div><p>In short, factors are categorical variables with a fixed number of values (think a set number of groups). One of the main features that set factors apart from groups is that you can reorder the groups to be non-alphabetical. In this section we will be using the <code>forcats</code> package (part of the <code>tidyverse</code>!) to create and manipulate factor variables.</p>
<div class="go-read">
<p>(Required) Go read about factors in <a href="https://r4ds.hadley.nz/factors.html">r4ds</a>. <br></p>
</div>
<p><br></p>
<section id="forcats" class="level3 unnumbered note"><h3 class="unnumbered anchored" data-anchor-id="forcats"><code>forcats</code></h3>
<p>Useful functions from the <code>forcats</code> package <em>(not an exhaustive list)</em>:</p>
<ul>
<li>
<code><a href="https://rdrr.io/r/base/factor.html">factor()</a></code>, <code><a href="https://rdrr.io/r/base/levels.html">levels()</a></code>
</li>
<li><code>fact_relevel()</code></li>
<li><code>fct_reorder()</code></li>
<li><code>fct_collapse()</code></li>
</ul>
<p>Download the <a href="https://posit.co/wp-content/uploads/2022/10/factors-1.pdf"><code>forcats</code> cheatsheet</a>.</p>
</section><p><br></p>
</section><section id="checkin5-1" class="level2 unnumbered check-in"><h2 class="unnumbered anchored" data-anchor-id="checkin5-1">Check-in 5.1: Functions from <code>forcats</code>
</h2>
<p>Answer the following questions in the Canvas Quiz.</p>
<p><strong>1. Which of the following tasks can <code>fct_recode()</code> accomplish?</strong></p>
<ul>
<li>changes the values of the factor levels</li>
<li>reorders the levels of a factor</li>
<li>remove levels of a factor you don’t want</li>
<li>collapse levels of a factor into a new level</li>
</ul>
<p><strong>2. Which of the following tasks can <code>fct_relevel()</code> accomplish?</strong></p>
<ul>
<li>reorders the levels of a factor</li>
<li>changes the values of the factor levels</li>
<li>remove levels of a factor you don’t want</li>
<li>collapse levels of a factor into a new level</li>
</ul>
<p><strong>3. What is the main difference between <code>fct_collapse()</code> and <code>fct_recode()</code>?</strong></p>
<ul>
<li>
<code>fct_recode()</code> uses strings to create factor levels</li>
<li>
<code>fct_recode()</code> uses groups to create factor levels</li>
<li>
<code>fct_recode()</code> cannot create an “Other” group</li>
</ul>
<p><strong>4. What ordering do you get with <code>fct_reorder()</code>?</strong></p>
<ul>
<li>largest to smallest based on another variable</li>
<li>order of appearance</li>
<li>largest to smallest based on counts</li>
<li>alphabetical order</li>
</ul>
<p><strong>5. What ordering do you get with <code>fct_inorder()</code>?</strong></p>
<ul>
<li>order of appearance</li>
<li>alphabetical order</li>
<li>largest to smallest based on counts</li>
<li>largest to smallest based on another variable</li>
</ul></section>
<!-- ### What is a factor? -->
<!-- Let's take a look at a vector, `days` which contains days of the week. -->
<!-- ```{r} -->
<!-- days <- c("Wed", "Thurs", "Sun", "Sun", "Mon") -->
<!-- days -->
<!-- ``` -->
<!-- The values in our vectors are categorical variables and therefore, `R` is automatically going to read the vector in as a character data type.  -->
<!-- ```{r} -->
<!-- class(days) -->
<!-- ``` -->
<!-- But let's think about what is contained in this vector. There are only seven days of the week and there is a natural ordering to those values.  -->
<!-- ::: warning -->
<!-- Working with `days` as a character vector introduces a couple of problems: -->
<!-- 1. There is nothing saving you from typos -- e.g., *Web* -->
<!-- ```{r} -->
<!-- days_misspelled <- c("Web", "Thurs", "Sun", "Sun", "Mon") -->
<!-- ``` -->
<!-- 2. and it sorts alphabetically. -->
<!-- ```{r} -->
<!-- sort(days) -->
<!-- ``` -->
<!-- ::: -->
<!-- We can convert `days` to a vector of `factor()` data types by defining a valid ordering and passing it into the levels function argument. -->
<!-- ```{r} -->
<!-- day_levels <- c("Mon", "Tues", "Wed", "Thurs", "Fri", "Sat", "Sun") -->
<!-- days_fct <- factor(days, levels = day_levels) -->
<!-- ``` -->
<!-- We can then see the `levels()` of our factor variable. -->
<!-- ```{r} -->
<!-- levels(days_fct) -->
<!-- ``` -->
<!-- Any values not defined as a factor level will be converted to <NA> just like `as.numeric()` did to values which were not numbers. -->
<!-- ```{r} -->
<!-- #| error: true -->
<!-- factor(days_misspelled, levels = day_levels) -->
<!-- ``` -->
<!-- Alternatively, you might accidentally miss the misspelling so using `fct()` from the `forcats` package will provide an error to alert you of the misspelling. -->
<!-- ```{r} -->
<!-- #| error: true -->
<!-- fct(days_misspelled, levels = day_levels) -->
<!-- ``` -->
<!-- You do not have to specify the levels when converting a variable into a vector, but they will automatically be defined in alphabetical order and the levels will only contain those values which appear in the original vector. -->
<!-- ```{r} -->
<!-- factor(days) -->
<!-- ``` -->
<!-- ## Factor Order -->
<!-- It may be useful, particularly in data visualizations, to order a factor variable based on the value of another variable. -->
<!-- ::: ex -->
<!-- Let's work with the `cereal` data set in the `liver` package. This data set contains nutrituional, manufacture, and marketing information for various cereals. -->
<!-- ```{r} -->
<!-- library(liver) -->
<!-- data(cereal) -->
<!-- str(cereal, hide.attr = TRUE) -->
<!-- ``` -->
<!-- Notice that manufacture `manuf` is a factor variable. Let's investigate! -->
<!-- The levels of the manufacture factor variable follows alphabetical order.  -->
<!-- ```{r} -->
<!-- levels(cereal$manuf) -->
<!-- ``` -->
<!-- We can use `count()` to find how many cereals are produced by each manufacturer. -->
<!-- ```{r} -->
<!-- cereal |>  -->
<!--   count(manuf) -->
<!-- ``` -->
<!-- We can use `dplyr` verbs to obtain summary statistics on nutritional content of the cereals for each manufacturer. -->
<!-- ```{r} -->
<!-- cereal_summary <- cereal |> -->
<!--   group_by(manuf) |>  -->
<!--   summarise(avg_sugars = mean(sugars), -->
<!--             n = n() -->
<!--             ) -->
<!-- cereal_summary -->
<!-- ``` -->
<!-- ::: panel-tabset -->
<!-- ### Original Plot -->
<!-- We can create a plot displaying the average sugar for each manufacture. -->
<!-- ```{r} -->
<!-- cereal_summary |>  -->
<!-- ggplot(aes(x = avg_sugars, y = manuf)) + -->
<!--   geom_segment(aes(xend = 0, yend = manuf)) + -->
<!--   geom_point() + -->
<!--   labs(x = "Average Sugar (grams)", -->
<!--        subtitle = "Manufacture Company", -->
<!--        y = "") + -->
<!--   theme_bw() -->
<!-- ``` -->
<!-- This is nice, but the points/segments are a little "out of order" or sporadic. Wouldn't it be nice if we could `reorder()` the levels of manufacture so that our plot shows the manufactures with the highest average sugar at the top?  -->
<!-- ### `fct_reorder()` -->
<!-- To accomplish this, we can use `fct_reorder()`: -->
<!-- + `f`, the factor variable whose levels you want to modify -->
<!-- + `x`, the numeric variable you want to use to reorder the levels -->
<!-- + (optional) `fun`, a function that is used if there are multiple values of the numeric variable for each factor group. The default function is the median. -->
<!-- Use `fct_reorder(manuf, avg_sugars)`! This looks a lot nicer. -->
<!-- ```{r} -->
<!-- cereal_summary |>  -->
<!-- ggplot(aes(x = avg_sugars, y = fct_reorder(manuf, avg_sugars))) + -->
<!--   geom_segment(aes(xend = 0, yend = manuf)) + -->
<!--   geom_point() + -->
<!--   labs(x = "Average Sugar (grams)", -->
<!--        subtitle = "Manufacture Company", -->
<!--        y = "") + -->
<!--   theme_bw() -->
<!-- ``` -->
<!-- Notice how we reordered within our `ggplot` code? You may want to do this before passing the data set in with the `mutate()` `dplyr` verb. -->
<!-- ```{r} -->
<!-- #| eval: false -->
<!-- cereal_summary |>  -->
<!--   mutate(manuf = fct_reorder(manuf, avg_sugars)) |>  -->
<!-- ggplot(aes(x = avg_sugars, y = manuf)) + -->
<!--   geom_segment(aes(xend = 0, yend = manuf)) + -->
<!--   geom_point() + -->
<!--   labs(x = "Average Sugar (grams)", -->
<!--        subtitle = "Manufacture Company", -->
<!--        y = "") + -->
<!--   theme_bw() -->
<!-- ``` -->
<!-- ::: -->
<!-- ::: -->
<!-- What if we want to  -->
<!-- ### `fct_relevel()` -->
<!-- ### `fct_reorder2()` -->
<!-- ### `fct_infreq()` -->
<div class="no-row-height column-margin column-container"><div class="">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="https://github.com/rstudio/hex-stickers/blob/main/thumbs/forcats.png?raw=true" class="img-fluid figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
</div></div><section id="string-operations-with-stringr" class="level2 page-columns page-full" data-number="5.2"><h2 data-number="5.2" class="anchored" data-anchor-id="string-operations-with-stringr">
<span class="header-section-number">5.2</span> String Operations with <code>stringr</code>
</h2>
<p>Nearly always, when multiple variables are stored in a single column, they are stored as character variables. There are many different “levels” of working with strings in programming, from simple find-and-replaced of fixed (constant) strings to regular expressions, which are extremely powerful (and extremely complicated).</p>

<div class="no-row-height column-margin column-container"><div class="">
<div class="youtube-video-container">
<iframe width="100%" height="auto" src="https://www.youtube.com/embed/Oo_MtXwpi2Q" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="">
</iframe>
</div>
</div></div><blockquote class="blockquote">
<p>Some people, when confronted with a problem, think “I know, I’ll use regular expressions.” Now they have two problems. - Jamie Zawinski</p>
</blockquote>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="https://imgs.xkcd.com/comics/perl_problems.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Alternately, the xkcd version of the above quote</figcaption></figure>
</div>
<div class="go-read">
<p>(required) Go read about strings in <a href="https://r4ds.hadley.nz/strings.html">r4ds</a>. <br></p>
</div>
<p><br></p>
<section id="stringr" class="level3 unnumbered note"><h3 class="unnumbered anchored" data-anchor-id="stringr"><code>stringr</code></h3>
<p>Download the <a href="https://posit.co/wp-content/uploads/2022/10/strings-1.pdf"><code>stringr</code> cheatsheet</a>.</p>
<table class="table">
<caption>Table of string functions in the R <code>stringr</code> package. <code>x</code> is the string or vector of strings, <code>pattern</code> is a pattern to be found within the string, <code>a</code> and <code>b</code> are indexes, and <code>encoding</code> is a string encoding, such as UTF8 or ASCII.</caption>
<colgroup>
<col style="width: 38%">
<col style="width: 38%">
<col style="width: 22%">
</colgroup>
<tbody>
<tr class="odd">
<td><strong>Task</strong></td>
<td><strong>stringr</strong></td>
<td></td>
</tr>
<tr class="even">
<td>Replace <code>pattern</code> with <code>replacement</code>
</td>
<td colspan="2">
<code>str_replace(x, pattern, replacement)</code> and <code>str_replace_all(x, pattern, replacement)</code>
</td>
</tr>
<tr class="odd">
<td>Convert case</td>
<td colspan="2">
<code>str_to_lower(x)</code>, <code>str_to_upper(x)</code> , <code>str_to_title(x)</code>
</td>
</tr>
<tr class="even">
<td>Strip whitespace from start/end</td>
<td colspan="2">
<code>str_trim(x)</code> , <code>str_squish(x)</code>
</td>
</tr>
<tr class="odd">
<td>Pad strings to a specific length</td>
<td colspan="2"><code>str_pad(x, …)</code></td>
</tr>
<tr class="even">
<td>Test if the string contains a pattern</td>
<td colspan="2"><code>str_detect(x, pattern)</code></td>
</tr>
<tr class="odd">
<td>Count how many times a pattern appears in the string</td>
<td colspan="2"><code>str_count(x, pattern)</code></td>
</tr>
<tr class="even">
<td>Find the first appearance of the pattern within the string</td>
<td colspan="2"><code>str_locate(x, pattern)</code></td>
</tr>
<tr class="odd">
<td>Find all appearances of the pattern within the string</td>
<td colspan="2"><code>str_locate_all(x, pattern)</code></td>
</tr>
<tr class="even">
<td>Detect a match at the start/end of the string</td>
<td colspan="2">
<code>str_starts(x, pattern)</code> ,<code>str_ends(x, pattern)</code>
</td>
</tr>
<tr class="odd">
<td>Subset a string from index a to b</td>
<td colspan="2"><code>str_sub(x, a, b)</code></td>
</tr>
<tr class="even">
<td>Convert string encoding</td>
<td colspan="2"><code>str_conv(x, encoding)</code></td>
</tr>
</tbody>
</table></section><!-- In @tbl-string-function, multiple functions are provided for e.g. common packages and situations. --><!-- ### Converting strings to numbers {.unnumbered} --><!-- One of the most common tasks when reading in and tidying messy data is that numeric-ish data can come in many forms that are read (by default) as strings. The data frame below provides an example of a few types of data which may be read in in unexpected ways. How do we tell R or Python that we want all of these columns to be treated as numbers? --><!-- Note that [numbers](https://docs.oracle.com/cd/E19455-01/806-0169/overview-8/index.html), currencies, dates, and times are written differently based on what country you're in [@ashourConciseGuideNumber2022]. In computer terms, this is the "locale", and it affects everything from how your computer formats the date/time to what character set it will try to use to display things [@LocaleComputerSoftware2022]. --><!-- [If you've never had to deal with the complexities of working on a laptop designed for one country using another country's conventions, know that it isn't necessarily the easiest thing to do.]{.aside} --><!-- ::: {.callout-note collapse="true"} --><!-- ##### Optional: Locales {.unnumbered} --><!-- ###### Find your locale {.unnumbered} --><!-- -   <i class="fa-brands fa-windows"></i> Type [`Get-WinSystemLocale`](https://docs.microsoft.com/en-us/powershell/module/international/get-winsystemlocale?view=windowsserver2022-ps#syntax) into your CMD or powershell terminal. --><!-- -   <i class="fa-brands fa-apple"></i> (10.4 and later) and <i class="fa-brands fa-linux"></i> Type `locale` into your terminal --><!-- ###### Get set up to work with locales {.unnumbered} --><!-- While this isn't required, it may be useful and is definitely good practice if you're planning to work with data generated internationally. --><!-- [This article](https://herrmann.tech/en/blog/2021/02/05/how-to-deal-with-international-data-formats-in-python.html) tells you how to set things up in linux <i class="fa-brands fa-linux"></i>. The biggest difference in other OS is going to be how to install new locales, so here are some instructions on that for other OS. --><!-- -   <i class="fa-brands fa-windows"></i> [Installing languages](https://support.microsoft.com/en-us/windows/install-a-language-for-windows-ccd853d3-9ecd-7da7-9ef0-72b4a055410a) --><!-- -   <i class="fa-brands fa-apple"></i> [Change locales](https://9to5mac.com/2018/08/09/mac-how-to-change-language-and-region/). Installing or creating new locales seems to be [more complicated](https://stackoverflow.com/questions/9991603/add-a-locale-in-mac-osx), and since I do not have a mac, I can't test this out easily myself. --><!-- ::: --><!-- We'll use @tbl-parse-numbers to explore different string operations focused specifically on converting strings to numbers. --><!-- ```{r} --><!-- df <- read.csv("https://raw.githubusercontent.com/srvanderplas/unl-stat850/main/data/number-formats.csv", colClasses = "character") --><!-- ``` --><!-- By default, R tries to outsmart us and read the data in as numbers. I've disabled this behavior by setting `colClasses='character'` so that you can see how these functions work... but in general, R seems to be a bit more willing to try to guess what you want. This can be useful, but can also be frustrating when you don't know how to disable it. --><!-- ::: callout-caution --><!-- ##### Converting Columns Using Your Best Guess {.unnumbered} --><!-- R has ways to "guess" what type a column is and read the data in as that type. When we initially read in the data above, I had to explicitly disable this behavior in R. If you're working with data that is already read in, how do you get R and Python to guess what type something is? --><!-- Here, R gets everything "right" except the eu_numbers, money_col, and custom cols, which makes sense - these contain information that isn't clearly numeric or doesn't match the default numeric formatting on my machine (which is using en_US.UTF-8 for almost everything). If we additionally want R to handle `mix_col`, we would have to explicitly convert to numeric, causing the a to be converted to `NA` --><!-- ```{r guess-type-conversion-r} --><!-- library(dplyr) --><!-- library(readr) --><!-- df_guess <- type_convert(df) --><!-- str(df_guess) --><!-- ``` --><!-- The `type_convert` function has a `locale` argument; `readr` includes a `locale()` function that you can pass to `type_convert` that allows you to define your own locale. Because we have numeric types structured from at least two locales in this data frame, we would have to specifically read the data in specifying which columns we wanted read with each locale. --><!-- ```{r guess-type-conversion-r-locale} --><!-- library(dplyr) --><!-- library(readr) --><!-- fixed_df <- type_convert(df)  --><!-- fixed_df2 <- type_convert(df, locale = locale(decimal_mark = ',', grouping_mark = '.')) --><!-- # Replace EU numbers col with the type_convert results specifying that locale --><!-- fixed_df$eu_numbers = fixed_df$eu_numbers --><!-- str(fixed_df) --><!-- ``` --><!-- ::: --><!-- ::: callout-caution --><!-- ##### Converting Columns Directly {.unnumbered} --><!-- Obviously, we can also convert some strings to numbers using type conversion functions that we discussed in @sec-type-conversions. This is fairly easy in R, but a bit more complex in Python, because Python has several different types of 'missing' or NA variables that are not necessarily compatible. --><!-- Here, we use the `across` helper function from dplyr to convert all of the columns to numeric. Note that the last 3 columns don't work here, because they contain characters R doesn't recognize as numeric characters. --><!-- ```{r direct-type-conversion-r} --><!-- library(dplyr) --><!-- df_numeric <- mutate(df, across(everything(), as.numeric)) --><!-- str(df_numeric) --><!-- ``` --><!-- ::: --><!-- ::: callout-caution --><!-- ##### Example: Converting Y/N data --><!-- The next thing we might want to do is convert our `custom` column so that it has 1 instead of Y and 0 instead of N. There are several ways we can handle this process: --><!-- -   We could use factors/categorical variables, which have numeric values "under the hood", but show up as labeled. --><!-- -   We could (in this particular case) test for equality with "Y", but this approach would not generalize well if we had more than 2 categories. --><!-- -   We could take a less nuanced approach and just find-replace and then convert to a number. --><!-- Some of these solutions are more kludgy than others, but I've used all 3 approaches when dealing with categorical data in the past, depending on what I wanted to do with it afterwards. --><!-- ```{r conversion-find-replace-r} --><!-- library(stringr) # work with strings easily --><!-- fixed_df = fixed_df %>% --><!--   mutate( --><!--     # factor approach --><!--     custom1 = factor(custom, levels = c("N", "Y"), labels = c("Y", "N")), --><!--     # test for equality --><!--     custom2 = (custom == "Y"), --><!--     # string replacement --><!--     custom3 = str_replace_all(custom, c("Y" = "1", "N" = "0")) %>% --><!--       as.numeric() --><!--   ) --><!-- str(fixed_df) --><!-- ``` --><!-- ::: --><!-- ### Using find and replace --><!-- Another way to fix some issues is to just find-and-replace the problematic characters. This is not always the best solution[^data-transformations-2], and may introduce bugs if you use the same code to analyze new data with characters you haven't anticipated, but in so many cases it's also the absolute easiest, fastest, simplest way forward and easily solves many different problems. --><!-- [^data-transformations-2]: It's particularly hackish when you're working with locale-specific settings [@herrmannHowDealInternational2021], and in many cases you can handle locale issues much more elegantly. --><!-- [I'll show you how to correct all of the issues reading in the data using solutions shown above, but please do consider reading @herrmannHowDealInternational2021 so that you know why find-and-replace isn't (necessarily) the best option for locale-specific formatting.]{.aside} --><!-- ::: callout-caution --><!-- ##### Example: find and replace --><!-- Let's start with the money column. --><!-- In R, parse_number() handles the money column just fine - the pound sign goes away and we get a numeric value. This didn't work by default with type_convert, but as long as we `mutate` and tell R we expect a number, things work well. Then, as we did above, we can specify the locale settings so that decimal and grouping marks are handled correctly even for countries which use ',' for decimal and '.' for thousands separators. --><!-- ```{r guess-type-conversion-r-money} --><!-- fixed_df = df %>% --><!--   type_convert() %>% # guess everything --><!--   mutate(money_col = parse_number(money_col), --><!--          eu_numbers = parse_number(eu_numbers,  --><!--                                    locale = locale(decimal_mark = ',',  --><!--                                                    grouping_mark = '.'))) --><!-- ``` --><!-- ::: --><!-- ::: callout-caution --><!-- #### Example: Locale find-and-replace --><!-- We could also handle the locale issues using find-and-replace, if we wanted to... --><!-- Note that `str_remove` is shorthand for `str_replace(x, pattern, "")`. There is a little bit of additional complexity in switching "," for "." and vice versa - we have to change "," to something else first, so that we can replace "." with ",". This is *not* elegant but it does work. It also doesn't generalize - it will mess up numbers formatted using the US/UK convention, and it won't handle numbers formatted using other conventions from other locales. --><!-- ```{r find-replace-locale-r} --><!-- fixed_df = df %>% --><!--   type_convert() %>% # guess everything --><!--   mutate(money_col = str_remove(money_col, "£") %>% parse_number(), --><!--          eu_numbers = str_replace_all(eu_numbers,  --><!--                                       c("," = "_",  --><!--                                         "\\." = ",",  --><!--                                         "_" = ".")) %>% --><!--            parse_number()) --><!-- ``` --><!-- ::: --><!-- ### Separating multi-variable columns and Joining Columns --><section id="regular-expressions" class="level3" data-number="5.2.1"><h3 data-number="5.2.1" class="anchored" data-anchor-id="regular-expressions">
<span class="header-section-number">5.2.1</span> Regular Expressions</h3>
<p>Matching exact strings is easy - it’s just like using find and replace.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">human_talk</span> <span class="op">&lt;-</span> <span class="st">"blah, blah, blah. Do you want to go for a walk?"</span></span>
<span><span class="va">dog_hears</span> <span class="op">&lt;-</span> <span class="fu">str_extract</span><span class="op">(</span><span class="va">human_talk</span>, <span class="st">"walk"</span><span class="op">)</span></span>
<span><span class="va">dog_hears</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "walk"</code></pre>
</div>
</div>
<p>But, if you can master even a small amount of regular expression notation, you’ll have exponentially more power to do good (or evil) when working with strings. You can get by without regular expressions if you’re creative, but often they’re much simpler.</p>
<details class="ex"><summary>
Short Regular Expressions Primer
</summary><p>You may find it helpful to follow along with this section using this <a href="https://spannbaueradam.shinyapps.io/r_regex_tester/">web app</a> built to test R regular expressions. The subset of regular expression syntax we’re going to cover here is fairly limited, but <a href="https://stackoverflow.com/questions/tagged/regex?tab=Votes">you can find regular expressions to do just about anything string-related</a>. As with any tool, there are situations where it’s useful, and situations where you should not use a regular expression, no matter how much you want to.</p>
<p>Here are the basics of regular expressions:</p>
<ul>
<li>
<code>[]</code> enclose sets of characters<br>
Ex: <code>[abc]</code> will match any single character <code>a</code>, <code>b</code>, <code>c</code>
<ul>
<li>
<code>-</code> specifies a range of characters (<code>A-z</code> matches all upper and lower case letters)</li>
<li>to match <code>-</code> exactly, precede with a backslash (outside of <code>[]</code>) or put the <code>-</code> last (inside <code>[]</code>)</li>
</ul>
</li>
<li>
<code>.</code> matches any character (except a newline)</li>
<li>To match special characters, escape them using <code>\</code> (in most languages) or <code>\\</code> (in R). So <code>\.</code> or <code>\\.</code> will match a literal <code>.</code>, <code>\$</code> or <code>\\$</code> will match a literal <code>$</code>.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">num_string</span> <span class="op">&lt;-</span> <span class="st">"phone: 123-456-7890, nuid: 12345678, ssn: 123-45-6789"</span></span>
<span></span>
<span><span class="va">ssn</span> <span class="op">&lt;-</span> <span class="fu">str_extract</span><span class="op">(</span><span class="va">num_string</span>, <span class="st">"[0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9][0-9][0-9]"</span><span class="op">)</span></span>
<span><span class="va">ssn</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "123-45-6789"</code></pre>
</div>
</div>
<p>Listing out all of those numbers can get repetitive, though. How do we specify repetition?</p>
<ul>
<li>
<code>*</code> means repeat between 0 and inf times</li>
<li>
<code>+</code> means 1 or more times</li>
<li>
<code>?</code> means 0 or 1 times – most useful when you’re looking for something optional</li>
<li>
<code>{a, b}</code> means repeat between <code>a</code> and <code>b</code> times, where <code>a</code> and <code>b</code> are integers. <code>b</code> can be blank. So <code>[abc]{3,}</code> will match <code>abc</code>, <code>aaaa</code>, <code>cbbaa</code>, but not <code>ab</code>, <code>bb</code>, or <code>a</code>. For a single number of repeated characters, you can use <code>{a}</code>. So <code>{3, }</code> means “3 or more times” and <code>{3}</code> means “exactly 3 times”</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org">stringr</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="st">"banana"</span>, <span class="st">"[a-z]{1,}"</span><span class="op">)</span> <span class="co"># match any sequence of lowercase characters</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "banana"</code></pre>
</div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="st">"banana"</span>, <span class="st">"[ab]{1,}"</span><span class="op">)</span> <span class="co"># Match any sequence of a and b characters</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "ba"</code></pre>
</div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract_all</a></span><span class="op">(</span><span class="st">"banana"</span>, <span class="st">"(..)"</span><span class="op">)</span> <span class="co"># Match any two characters</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] "ba" "na" "na"</code></pre>
</div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="st">"banana"</span>, <span class="st">"(..)\\1"</span><span class="op">)</span> <span class="co"># Match a repeated thing</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "anan"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">num_string</span> <span class="op">&lt;-</span> <span class="st">"phone: 123-456-7890, nuid: 12345678, ssn: 123-45-6789, bank account balance: $50,000,000.23"</span></span>
<span></span>
<span><span class="va">ssn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">num_string</span>, <span class="st">"[0-9]{3}-[0-9]{2}-[0-9]{4}"</span><span class="op">)</span></span>
<span><span class="va">ssn</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "123-45-6789"</code></pre>
</div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">phone</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">num_string</span>, <span class="st">"[0-9]{3}.[0-9]{3}.[0-9]{4}"</span><span class="op">)</span></span>
<span><span class="va">phone</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "123-456-7890"</code></pre>
</div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">nuid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">num_string</span>, <span class="st">"[0-9]{8}"</span><span class="op">)</span></span>
<span><span class="va">nuid</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "12345678"</code></pre>
</div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bank_balance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">num_string</span>, <span class="st">"\\$[0-9,]+\\.[0-9]{2}"</span><span class="op">)</span></span>
<span><span class="va">bank_balance</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "$50,000,000.23"</code></pre>
</div>
</div>
<p>There are also ways to “anchor” a pattern to a part of the string (e.g.&nbsp;the beginning or the end)</p>
<ul>
<li>
<code>^</code> has multiple meanings:
<ul>
<li>if it’s the first character in a pattern, <code>^</code> matches the beginning of a string</li>
<li>if it follows <code>[</code>, e.g.&nbsp;<code>[^abc]</code>, <code>^</code> means “not” - for instance, “the collection of all characters that aren’t a, b, or c”.</li>
</ul>
</li>
<li>
<code>$</code> means the end of a string</li>
</ul>
<p>Combined with pre and post-processing, these let you make sense out of semi-structured string data, such as addresses.</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">address</span> <span class="op">&lt;-</span> <span class="st">"1600 Pennsylvania Ave NW, Washington D.C., 20500"</span></span>
<span></span>
<span><span class="va">house_num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">address</span>, <span class="st">"^[0-9]{1,}"</span><span class="op">)</span></span>
<span></span>
<span> <span class="co"># Match everything alphanumeric up to the comma</span></span>
<span><span class="va">street</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">address</span>, <span class="st">"[A-z0-9 ]{1,}"</span><span class="op">)</span></span>
<span><span class="va">street</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="va">street</span>, <span class="va">house_num</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trim.html">str_trim</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># remove house number</span></span>
<span></span>
<span><span class="va">city</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">address</span>, <span class="st">",.*,"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all</a></span><span class="op">(</span><span class="st">","</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trim.html">str_trim</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">zip</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">address</span>, <span class="st">"[0-9-]{5,10}$"</span><span class="op">)</span> <span class="co"># match 5 and 9 digit zip codes</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>
<code>()</code> are used to capture information. So <code>([0-9]{4})</code> captures any 4-digit number</li>
<li>
<code>a|b</code> will select a or b.</li>
</ul>
<p>If you’ve captured information using (), you can reference that information using backreferences. In most languages, those look like this: <code>\1</code> for the first reference, <code>\9</code> for the ninth. In R, backreferences are <code>\\1</code> through <code>\\9</code>.</p>
<p>In R, the <code>\</code> character is special, so you have to escape it. So in R, <code>\\1</code> is the first reference, and <code>\\2</code> is the second, and so on.</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">phone_num_variants</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"(123) 456-7980"</span>, <span class="st">"123.456.7890"</span>, <span class="st">"+1 123-456-7890"</span><span class="op">)</span></span>
<span><span class="va">phone_regex</span> <span class="op">&lt;-</span> <span class="st">"\\+?[0-9]{0,3}? ?\\(?([0-9]{3})?\\)?.?([0-9]{3}).?([0-9]{4})"</span></span>
<span><span class="co"># \\+?[0-9]{0,3} matches the country code, if specified, </span></span>
<span><span class="co">#    but won't take the first 3 digits from the area code </span></span>
<span><span class="co">#    unless a country code is also specified</span></span>
<span><span class="co"># \\( and \\) match literal parentheses if they exist</span></span>
<span><span class="co"># ([0-9]{3})? captures the area code, if it exists</span></span>
<span><span class="co"># .? matches any character</span></span>
<span><span class="co"># ([0-9]{3}) captures the exchange code</span></span>
<span><span class="co"># ([0-9]{4}) captures the 4-digit individual code</span></span>
<span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">phone_num_variants</span>, <span class="va">phone_regex</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "(123) 456-7980"  "123.456.7890"    "+1 123-456-7890"</code></pre>
</div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="va">phone_num_variants</span>, <span class="va">phone_regex</span>, <span class="st">"\\1\\2\\3"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "1234567980" "1234567890" "1234567890"</code></pre>
</div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># We didn't capture the country code, so it remained in the string</span></span>
<span></span>
<span><span class="va">human_talk</span> <span class="op">&lt;-</span> <span class="st">"blah, blah, blah. Do you want to go for a walk? I think I'm going to treat myself to some ice cream for working so hard. "</span></span>
<span><span class="va">dog_hears</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract_all</a></span><span class="op">(</span><span class="va">human_talk</span>, <span class="st">"walk|treat"</span><span class="op">)</span></span>
<span><span class="va">dog_hears</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] "walk"  "treat"</code></pre>
</div>
</div>
<p>Putting it all together, we can test our regular expressions to ensure that they are specific enough to pull out what we want, while not pulling out other similar information:</p>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">strings</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"abcdefghijklmnopqrstuvwxyzABAB"</span>,</span>
<span><span class="st">"banana orange strawberry apple"</span>,</span>
<span><span class="st">"ana went to montana to eat a banana"</span>,</span>
<span><span class="st">"call me at 432-394-2873. Do you want to go for a walk? I'm going to treat myself to some ice cream for working so hard."</span>,</span>
<span><span class="st">"phone: (123) 456-7890, nuid: 12345678, bank account balance: $50,000,000.23"</span>,</span>
<span><span class="st">"1600 Pennsylvania Ave NW, Washington D.C., 20500"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">phone_regex</span> <span class="op">&lt;-</span> <span class="st">"\\+?[0-9]{0,3}? ?\\(?([0-9]{3})?\\)?.?([0-9]{3}).([0-9]{4})"</span></span>
<span><span class="va">dog_regex</span> <span class="op">&lt;-</span> <span class="st">"(walk|treat)"</span></span>
<span><span class="va">addr_regex</span> <span class="op">&lt;-</span> <span class="st">"([0-9]*) ([A-z0-9 ]{3,}), ([A-z\\. ]{3,}), ([0-9]{5})"</span></span>
<span><span class="va">abab_regex</span> <span class="op">&lt;-</span> <span class="st">"(..)\\1"</span></span>
<span></span>
<span><span class="fu">tibble</span><span class="op">(</span></span>
<span>  text <span class="op">=</span> <span class="va">strings</span>,</span>
<span>  phone <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">strings</span>, <span class="va">phone_regex</span><span class="op">)</span>,</span>
<span>  dog <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">strings</span>, <span class="va">dog_regex</span><span class="op">)</span>,</span>
<span>  addr <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">strings</span>, <span class="va">addr_regex</span><span class="op">)</span>,</span>
<span>  abab <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">strings</span>, <span class="va">abab_regex</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  text                                                   phone dog   addr  abab 
  &lt;chr&gt;                                                  &lt;lgl&gt; &lt;lgl&gt; &lt;lgl&gt; &lt;lgl&gt;
1 abcdefghijklmnopqrstuvwxyzABAB                         FALSE FALSE FALSE TRUE 
2 banana orange strawberry apple                         FALSE FALSE FALSE TRUE 
3 ana went to montana to eat a banana                    FALSE FALSE FALSE TRUE 
4 call me at 432-394-2873. Do you want to go for a walk… TRUE  TRUE  FALSE FALSE
5 phone: (123) 456-7890, nuid: 12345678, bank account b… TRUE  FALSE FALSE FALSE
6 1600 Pennsylvania Ave NW, Washington D.C., 20500       FALSE FALSE TRUE  FALSE</code></pre>
</div>
</div>
</details><p><br></p>
<div class="go-read">
<p>(semi-required) Go read more about regular expressions in <a href="https://r4ds.hadley.nz/regexps.html">r4ds</a>.</p>
<p>Read at least through <strong>section 17.4.1</strong>.</p>
<p><br></p>
</div>
<p><br></p>
</section></section><section id="checkin5-2" class="level2 unnumbered check-in"><h2 class="unnumbered anchored" data-anchor-id="checkin5-2">Check-in 5.2: Functions from <code>stringr</code>
</h2>
<p><strong>1 Which of the follow are differences between <code><a href="https://rdrr.io/r/base/length.html">length()</a></code> and <code><a href="https://stringr.tidyverse.org/reference/str_length.html">str_length()</a></code>?</strong></p>
<ul>
<li>
<code><a href="https://rdrr.io/r/base/length.html">length()</a></code> gives the number of elements in a vector</li>
<li>
<code><a href="https://stringr.tidyverse.org/reference/str_length.html">str_length()</a></code> gives the number of characters in a string</li>
<li>
<code><a href="https://stringr.tidyverse.org/reference/str_length.html">str_length()</a></code> gives the number of strings in a vector</li>
<li>
<code><a href="https://rdrr.io/r/base/length.html">length()</a></code> gives the dimensions of a dataframe</li>
</ul>
<p><strong>2 What of the following is true about <code><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace()</a></code>?</strong></p>
<ul>
<li>
<code><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace()</a></code> replaces the first instance of the pattern</li>
<li>
<code><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace()</a></code> replaces the last instance of the pattern</li>
<li>
<code><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace()</a></code> replaces every instance of the pattern</li>
</ul>
<p><strong>3 <code><a href="https://stringr.tidyverse.org/reference/str_trim.html">str_trim()</a></code> allows you to remove whitespace on what sides</strong></p>
<ul>
<li>both</li>
<li>left</li>
<li>right</li>
</ul>
<p><strong>4 Which of the following does <code><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub()</a></code> use to create a substring?</strong></p>
<ul>
<li>starting position</li>
<li>ending position</li>
<li>pattern to search for</li>
</ul>
<p><strong>5 Which of the following does <code><a href="https://stringr.tidyverse.org/reference/str_subset.html">str_subset()</a></code> use to create a substring?</strong></p>
<ul>
<li>starting position</li>
<li>ending position</li>
<li>pattern to search for</li>
</ul>
<p><strong>6 What does the collapse argument do in <code><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c()</a></code>?</strong></p>
<ul>
<li>specifies a string to be used when combining inputs into a single string</li>
<li>specifies whether the string should be collapsed</li>
</ul></section><section id="dates-times-with-lubridate" class="level2 page-columns page-full" data-number="5.3"><h2 data-number="5.3" class="anchored" data-anchor-id="dates-times-with-lubridate">
<span class="header-section-number">5.3</span> Dates &amp; Times with <code>lubridate</code>
</h2>
<p>In order to fill in an important part of our toolbox, we need to learn how to work with date variables. These variables feel like they should be simple and intuitive given we all work with schedules and calendars everyday. However, there are little nuances that we will learn to make working with dates and times easier.</p>

<div class="no-row-height column-margin column-container"><div class="">
<div class="youtube-video-container">
<iframe width="100%" height="auto" src="https://www.youtube.com/embed/SEPjN2AJqbo" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="">
</iframe>
</div>
</div></div><div class="go-read">
<p>(Required) GO read about dates and times in <a href="https://r4ds.hadley.nz/datetimes.html">r4ds</a>. <br></p>
</div>
<p><br></p>
<div class="note">
<ul>
<li><a href="https://lubridate.tidyverse.org/reference/index.html"><code>lubridate</code> website</a></li>
<li><a href="https://posit.co/wp-content/uploads/2022/10/lubridate-1.pdf">Download the <code>lubridate</code> cheatsheet</a></li>
</ul>
</div>
<p><br></p>
<section id="learn-more-about-dates-and-times" class="level3 unnumbered learn-more"><h3 class="unnumbered anchored" data-anchor-id="learn-more-about-dates-and-times">Learn more about dates and times</h3>
<ul>
<li><p><a href="https://www.cyclismo.org/tutorial/R/time.html">A more in-depth discussion of the POSIXlt and POSIXct data classes.</a></p></li>
<li><p><a href="https://data.library.virginia.edu/working-with-dates-and-time-in-r-using-the-lubridate-package/">A tutorial on <code>lubridate</code></a> - scroll down for details on intervals if you have trouble with %within% and %–%</p></li>
</ul></section><p><br></p>
</section><section id="checkin5-3" class="level2 unnumbered check-in"><h2 class="unnumbered anchored" data-anchor-id="checkin5-3">Check-in 5.3: Functions from <code>lubridate</code>
</h2>
<p><strong>1 Which of the following is true about the year() function?</strong></p>
<ul>
<li>
<code>year()</code> extracts the year of a datetime object</li>
<li>
<code>year()</code> creates a duration object to be added to a datetime</li>
</ul>
<p><strong>2 What <code>tz</code> would you use for San Luis Obispo?</strong></p>
<!-- tz = "America/Los_Angeles" -->
<p><strong>3 Which of the following is true about the <code>%within%</code> operator?</strong></p>
<ul>
<li>it checks if a date is included in an interval</li>
<li>it returns a logical value</li>
<li>it creates an interval with a start and end time</li>
</ul>
<p><strong>4 Which of the following is true about the <code>%--%</code> operator?</strong></p>
<ul>
<li>it creates an interval with a start and end time</li>
<li>it returns a logical value</li>
<li>it checks if a date is included in an interval</li>
</ul>
<p><strong>5 What day of the month does the <code>make_date()</code> function use as default if no <code>day</code> argument is provided?</strong></p>
</section><section id="practice-activities" class="level2 unnumbered page-columns page-full"><h2 class="unnumbered anchored" data-anchor-id="practice-activities">Practice Activities</h2>
<section id="pa-5.1-zodiac-killer" class="level3 unnumbered tryitout"><h3 class="unnumbered anchored" data-anchor-id="pa-5.1-zodiac-killer">PA 5.1: Zodiac Killer</h3>
<p>One of the most famous mysteries in California history is the identity of the so-called “Zodiac Killer”, who murdered 7 people in Northern California between 1968 and 1969. A new murder was committed last year in California, suspected to be the work of a new Zodiac Killer on the loose.</p>
<p>Unfortunately, the date and time of the murder is not known. You have been hired to crack the case. Use the clues below to discover the murderer’s identity.</p>
<p>Visit <a href="https://earobinson95.github.io/stat331-calpoly/practice-activities/PA5_1-zodiac-killer.html">PA 5.1: Zodiac Killer</a> for instructions.</p>
<blockquote class="blockquote">
<p>Submit the name of the killer to the Canvas Quiz.</p>
</blockquote>
</section>
<div class="no-row-height column-margin column-container"><div class="">
<div class="note">
<p>We will have two practice activities this week as opposed to our usual one. The first practice activity, PA 5.1 Zodiac Killer will be completed in class on Monday and due Wednesday morning. The second practice activity, PA 5.2 Scrambled Message will be completed in class on Wednesday and due Friday morning.</p>
</div>
</div></div><p><br></p>
<section id="pa-5.2-scrambled-message" class="level3 unnumbered tryitout"><h3 class="unnumbered anchored" data-anchor-id="pa-5.2-scrambled-message">PA 5.2: Scrambled Message</h3>
<p>In this activity, you will be using regular expressions to decode a message.</p>
<p>Visit <a href="https://earobinson95.github.io/stat331-calpoly/practice-activities/PA5_2-scrambled-message-regex.html">PA 5.2: Scrambled Message</a> for instructions.</p>
<blockquote class="blockquote">
<p>Submit the movie name the quote contained in the secret message is from to the Canvas Quiz</p>
</blockquote>
</section><section id="references" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="references">References</h3>


</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./04-data-joins-and-transformations.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data Joins and Transformations</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./06-shiny.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Shiny (a web application)</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>