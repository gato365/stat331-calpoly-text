<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Stat 331/531 Statistical Computing with R - 10&nbsp; Predictive Checks</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./09-statistical-modeling-and-simulation.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><link rel="stylesheet" href="style.css">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./10-predictive-checks.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Predictive Checks</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Stat 331/531 Statistical Computing with R</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/earobinson95/stat331-calpoly-text" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
<li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=%7Curl%7C">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=%7Curl%7C">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=%7Curl%7C">
              <i class="bi bi-bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
</div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-prereading.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Pre-reading</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-tidy-data-and-basics-of-graphics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Tidy Data &amp; Basics of Graphics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-data-cleaning-and-manipulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data Cleaning and Manipulation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-data-joins-and-transformations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data Joins and Transformations</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-special-data-types.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Special Data Types</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-shiny.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Shiny (a web application)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Writing Functions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-functional-programming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Functional Programming</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-statistical-modeling-and-simulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Regression &amp; Simulating Distributions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-predictive-checks.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Predictive Checks</span></span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#ch10-objectives" id="toc-ch10-objectives" class="nav-link active" data-scroll-target="#ch10-objectives">Objectives</a></li>
  <li><a href="#ch10-checkins" id="toc-ch10-checkins" class="nav-link" data-scroll-target="#ch10-checkins">Check-ins</a></li>
  <li>
<a href="#model-checking" id="toc-model-checking" class="nav-link" data-scroll-target="#model-checking"><span class="header-section-number">10.1</span> Model Checking</a>
  <ul class="collapse">
<li><a href="#predictive-checks-bayesian-modeling-and-subjectivity" id="toc-predictive-checks-bayesian-modeling-and-subjectivity" class="nav-link" data-scroll-target="#predictive-checks-bayesian-modeling-and-subjectivity"><span class="header-section-number">10.1.1</span> Predictive Checks, Bayesian Modeling, and Subjectivity</a></li>
  <li><a href="#predictive-checks-in-a-linear-regression" id="toc-predictive-checks-in-a-linear-regression" class="nav-link" data-scroll-target="#predictive-checks-in-a-linear-regression"><span class="header-section-number">10.1.2</span> Predictive Checks in a Linear Regression</a></li>
  <li><a href="#connection-to-model-conditions" id="toc-connection-to-model-conditions" class="nav-link" data-scroll-target="#connection-to-model-conditions"><span class="header-section-number">10.1.3</span> Connection to Model Conditions</a></li>
  </ul>
</li>
  <li>
<a href="#performing-a-predicitive-check-for-a-linear-regression" id="toc-performing-a-predicitive-check-for-a-linear-regression" class="nav-link" data-scroll-target="#performing-a-predicitive-check-for-a-linear-regression"><span class="header-section-number">10.2</span> Performing a Predicitive Check for a Linear Regression</a>
  <ul class="collapse">
<li><a href="#obtaining-predictions-predict" id="toc-obtaining-predictions-predict" class="nav-link" data-scroll-target="#obtaining-predictions-predict"><span class="header-section-number">10.2.1</span> Obtaining Predictions <code>predict()</code></a></li>
  <li><a href="#extracting-the-estimate-of-sigma-sigma" id="toc-extracting-the-estimate-of-sigma-sigma" class="nav-link" data-scroll-target="#extracting-the-estimate-of-sigma-sigma"><span class="header-section-number">10.2.2</span> Extracting the Estimate of <span class="math inline">\(\sigma\)</span> <code>sigma()</code></a></li>
  <li><a href="#adding-errors-noise-to-predictions-rnorm" id="toc-adding-errors-noise-to-predictions-rnorm" class="nav-link" data-scroll-target="#adding-errors-noise-to-predictions-rnorm"><span class="header-section-number">10.2.3</span> Adding Errors / Noise to Predictions <code>rnorm()</code></a></li>
  </ul>
</li>
  <li>
<a href="#plotting-predictions" id="toc-plotting-predictions" class="nav-link" data-scroll-target="#plotting-predictions"><span class="header-section-number">10.3</span> Plotting Predictions</a>
  <ul class="collapse">
<li><a href="#distribution-of-responses" id="toc-distribution-of-responses" class="nav-link" data-scroll-target="#distribution-of-responses"><span class="header-section-number">10.3.1</span> Distribution of Responses</a></li>
  <li><a href="#adding-in-the-observed-xs" id="toc-adding-in-the-observed-xs" class="nav-link" data-scroll-target="#adding-in-the-observed-xs"><span class="header-section-number">10.3.2</span> Adding in the Observed x’s</a></li>
  <li><a href="#scatterplot-of-relationships" id="toc-scatterplot-of-relationships" class="nav-link" data-scroll-target="#scatterplot-of-relationships"><span class="header-section-number">10.3.3</span> Scatterplot of Relationships</a></li>
  </ul>
</li>
  <li><a href="#assessing-predictions" id="toc-assessing-predictions" class="nav-link" data-scroll-target="#assessing-predictions"><span class="header-section-number">10.4</span> Assessing Predictions</a></li>
  <li>
<a href="#iterating" id="toc-iterating" class="nav-link" data-scroll-target="#iterating"><span class="header-section-number">10.5</span> Iterating!</a>
  <ul class="collapse">
<li><a href="#lots-of-simulated-observations" id="toc-lots-of-simulated-observations" class="nav-link" data-scroll-target="#lots-of-simulated-observations"><span class="header-section-number">10.5.1</span> Lots of Simulated Observations</a></li>
  <li><a href="#lots-of-regressions-r2-values" id="toc-lots-of-regressions-r2-values" class="nav-link" data-scroll-target="#lots-of-regressions-r2-values"><span class="header-section-number">10.5.2</span> Lots of Regressions &amp; <span class="math inline">\(R^2\)</span> Values</a></li>
  <li><a href="#inspecting-the-r2-values" id="toc-inspecting-the-r2-values" class="nav-link" data-scroll-target="#inspecting-the-r2-values"><span class="header-section-number">10.5.3</span> Inspecting the <span class="math inline">\(R^2\)</span> Values</a></li>
  <li><a href="#plotting-the-simulated-r2-values-versus-the-observed-r2" id="toc-plotting-the-simulated-r2-values-versus-the-observed-r2" class="nav-link" data-scroll-target="#plotting-the-simulated-r2-values-versus-the-observed-r2"><span class="header-section-number">10.5.4</span> Plotting the Simulated <span class="math inline">\(R^2\)</span> Values versus the Observed <span class="math inline">\(R^2\)</span></a></li>
  </ul>
</li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/earobinson95/stat331-calpoly-text/edit/main/10-predictive-checks.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">
<span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Predictive Checks</span>
</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><p><svg aria-hidden="true" role="img" viewbox="0 0 576 512" style="height:1em;width:1.12em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M249.6 471.5c10.8 3.8 22.4-4.1 22.4-15.5V78.6c0-4.2-1.6-8.4-5-11C247.4 52 202.4 32 144 32C93.5 32 46.3 45.3 18.1 56.1C6.8 60.5 0 71.7 0 83.8V454.1c0 11.9 12.8 20.2 24.1 16.5C55.6 460.1 105.5 448 144 448c33.9 0 79 14 105.6 23.5zm76.8 0C353 462 398.1 448 432 448c38.5 0 88.4 12.1 119.9 22.6c11.3 3.8 24.1-4.6 24.1-16.5V83.8c0-12.1-6.8-23.3-18.1-27.6C529.7 45.3 482.5 32 432 32c-58.4 0-103.4 20-123 35.6c-3.3 2.6-5 6.8-5 11V456c0 11.4 11.7 19.3 22.4 15.5z"></path></svg> Reading: 11 minute(s) at 200 WPM</p>
<p><svg aria-hidden="true" role="img" viewbox="0 0 576 512" style="height:1em;width:1.12em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M0 128C0 92.7 28.7 64 64 64H320c35.3 0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V128zM559.1 99.8c10.4 5.6 16.9 16.4 16.9 28.2V384c0 11.8-6.5 22.6-16.9 28.2s-23 5-32.9-1.6l-96-64L416 337.1V320 192 174.9l14.2-9.5 96-64c9.8-6.5 22.4-7.2 32.9-1.6z"></path></svg> Videos: NA</p>
<section id="ch10-objectives" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="ch10-objectives">Objectives</h2>
<p>This chapter is heavily from Dr.&nbsp;Theobold’s course-page material.</p>
<ul>
<li>Make predictions from a linear model</li>
<li>Include variability into predictions</li>
<li>Understand what is assumed about the data generating process in a linear regression</li>
<li>Assess if the assumed linear model accurately describes the observed data</li>
</ul></section><section id="ch10-checkins" class="level2 unnumbered check-in"><h2 class="unnumbered anchored" data-anchor-id="ch10-checkins">Check-ins</h2>
<p>There is one check-in for this week:</p>
<ul>
<li>Check-in 10.1: Linear Regression</li>
</ul>
<blockquote class="blockquote">
<p>There are 7 questions scattered throughout the reading this week.</p>
</blockquote>
</section><p><br></p>
<blockquote class="blockquote">
<p>It is difficult to include in a [statistical model] all of one’s knowledge about a problem, and so it is wise to investigate what aspects of reality are not captured by the model.</p>
<ul>
<li>Andrew Gelman, Bayesian Data Analysis</li>
</ul>
</blockquote>
<section id="model-checking" class="level2" data-number="10.1"><h2 data-number="10.1" class="anchored" data-anchor-id="model-checking">
<span class="header-section-number">10.1</span> Model Checking</h2>
<p>In explanatory modeling, it is incredibly important to check if you can make sound inferences from the model that was fit. Whether the model is a “simple” difference in means or a more “complex” multiple linear regression, the estimated coefficients obtained from the model should not be used for inference if the conditions of the model are violated. Typically, model checking for a linear regression is taught through a “residual analysis,” inspecting different visualizations of the residuals from the model. This week, however, we will learn a different way to assess our regression model.</p>
<section id="predictive-checks-bayesian-modeling-and-subjectivity" class="level3" data-number="10.1.1"><h3 data-number="10.1.1" class="anchored" data-anchor-id="predictive-checks-bayesian-modeling-and-subjectivity">
<span class="header-section-number">10.1.1</span> Predictive Checks, Bayesian Modeling, and Subjectivity</h3>
<p>The idea of predictive checks for a statistical model are most often seen in the context of Bayesian modeling. In Bayesian modeling, rather than obtaining a single estimate for a parameter, you obtain a distribution of plausible values for that parameter. The distribution suggests which values of that parameter are more or less likely, given what was seen in the data and the prior knowledge incorporated into the model.</p>
<p>The prior knowledge about what values we expect for the parameter comes in the form of a prior distribution. Different statisticians may choose a different prior distributions, much like different statisticians might choose different variables to include in their regression. Although there are large similarities between the choice of a prior distribution and the choice of a statistical model, prior distributions receive a great deal of flack for how the interlace “subjectivity” into the statistical modeling process.</p>
<p>Due in part to these criticisms regarding the choice of a prior distribution, it is common in Bayesian analyses to perform predictive checks to assess the fit of the model to the data at hand. While we are not fitting Bayesian models, I believe there is a great deal we can learn from the concept of using predictive checks for any statistical model. Any good analysis should include a check of the “adequacy of the fit of the model to the data and the plausibility of the model for the purposes for which the model will be used” <span class="citation" data-cites="gelman_2014">(<a href="#ref-gelman_2014" role="doc-biblioref">Gelman 2014</a>)</span>.</p>
</section><section id="predictive-checks-in-a-linear-regression" class="level3" data-number="10.1.2"><h3 data-number="10.1.2" class="anchored" data-anchor-id="predictive-checks-in-a-linear-regression">
<span class="header-section-number">10.1.2</span> Predictive Checks in a Linear Regression</h3>
<p>Under a simple linear regression model, we assume that the responses can be modeled as a function of the explanatory variable and some error:</p>
<p><span class="math display">\[y = \beta_0 + \beta_1 \cdot x_1 + \epsilon\]</span></p>
<p>In a linear model we assume that the errors (<span class="math inline">\(\epsilon\)</span>) follow a Normal distribution with mean 0 and standard deviation (<span class="math inline">\(\sigma\)</span>) – <span class="math inline">\(\epsilon \sim N(0,\sigma)\)</span>.</p>
<p>This implies that we can simulate data that we would <strong>expect</strong> to come from this model, by adding normally distributed errors to the values predicted from the linear regression. Moreover, when we randomly generate these errors, we better understand what the “normality,” “equal variance,” and “independence” conditions mean in the context of the linear regression model.</p>
</section><section id="connection-to-model-conditions" class="level3" data-number="10.1.3"><h3 data-number="10.1.3" class="anchored" data-anchor-id="connection-to-model-conditions">
<span class="header-section-number">10.1.3</span> Connection to Model Conditions</h3>
<p>A linear regression model has four conditions, which follow the LINE acronym:</p>
<p><strong>L</strong>inear relationship between <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> <strong>I</strong>ndependence of observations <strong>N</strong>ormality of residuals <strong>E</strong>qual variance of residuals</p>
<p>The first condition relates to the relationship between the explanatory (<span class="math inline">\(x\)</span>) and response (<span class="math inline">\(y\)</span>) variable. As you might expect, using a line to model a non-linear relationship is a bad choice! Thus, we will only make predictions from a linear regression where there appears to be a linear relationship between the variables.</p>
<p>The process of adding normally distributed errors to the predictions from the linear regression assumes three things:</p>
<ol type="1">
<li>the errors follow a specific distribution, namely <span class="math inline">\(N(0,\sigma)\)</span>
</li>
<li>the errors all have the same variance (<span class="math inline">\(\sigma\)</span>)</li>
<li>the errors are not related to each other</li>
</ol>
<p>The Normality and equal variance conditions are manifested in using the <span class="math inline">\(N(0,\sigma)\)</span> distribution to generate the errors. The independence condition is manifested in the assumption that we can draw random errors for each observation (prediction), because the errors are not related to each other.</p>
<p>This might feel like a bit of a stretch, especially if you haven’t seen linear regression in a bit, so let me break this down a bit more. When we assume that observations are independent, we are saying that we shouldn’t be able to know the <span class="math inline">\(y\)</span> value for one observation just from knowing the <span class="math inline">\(y\)</span> value of another observation. If I have repeated observations, like values for the same country across multiple years, then it’s pretty likely that I can guess the value of a variable in 1991 from knowing the same variable’s value in 1990. Since we are using linear regression to model the relationship between the explanatory variable(s) and the response, this assumption can be rephrased in terms of each observation’s residual. Specifically, knowing the residual for one observation shouldn’t give us perfect information about the residual for another observation. Because we are assuming that the observations / residuals are independent, we can randomly draw an error for each observation.</p>
</section></section><section id="performing-a-predicitive-check-for-a-linear-regression" class="level2" data-number="10.2"><h2 data-number="10.2" class="anchored" data-anchor-id="performing-a-predicitive-check-for-a-linear-regression">
<span class="header-section-number">10.2</span> Performing a Predicitive Check for a Linear Regression</h2>
<p>I will be walking through how to carry out the process of performing a predictive check for a simple linear regression model in the context of the <code>penguins</code> data set from the <strong>palmerpenguins</strong> package.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/">palmerpenguins</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">penguins</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will start by fitting a simple linear regression model, modeling a penguin’s <code>body_mass_g</code> as a function of their <code>flipper_length_mm</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">flipper_length_mm</span>, y <span class="op">=</span> <span class="va">body_mass_g</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_smooth</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Flipper Length (mm)"</span>, </span>
<span>       y <span class="op">=</span> <span class="st">""</span>, </span>
<span>       title <span class="op">=</span> <span class="st">"Relationship between Flipper Length (mm) and Body Mass (g)"</span>, </span>
<span>       subtitle <span class="op">=</span> <span class="st">"for Penguins on Palmer Archipelago"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="10-predictive-checks_files/figure-html/scatterplot-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguin_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">body_mass_g</span> <span class="op">~</span> <span class="va">flipper_length_mm</span>, data  <span class="op">=</span> <span class="va">penguins</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="obtaining-predictions-predict" class="level3" data-number="10.2.1"><h3 data-number="10.2.1" class="anchored" data-anchor-id="obtaining-predictions-predict">
<span class="header-section-number">10.2.1</span> Obtaining Predictions <code>predict()</code>
</h3>
<p>The next step is to obtain the predictions (<code>.fitted</code> values) from the regression model. There is a handy built-in function for extracting the predicted values from a <code>lm</code> object – the <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> function.</p>
<div class="note">
<p>Recall we also have the <code>augment()</code> function that will provide us with the <code>.fitted</code> values – this is analogous to the predictions from <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code>.</p>
</div>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguin_predict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">penguin_lm</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">penguin_predict</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       1        2        3        5        6        7 
3212.256 3460.684 3907.854 3808.483 3659.426 3212.256 </code></pre>
</div>
</div>
<section id="q1-the-predict-function" class="level4 unnumbered check-in"><h4 class="unnumbered anchored" data-anchor-id="q1-the-predict-function">Q1: The <code>predict()</code> function</h4>
<p>What is the data structure of the predictions that are output by the <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> function?</p>
<ol type="a">
<li>list</li>
<li>vector</li>
<li>matrix</li>
<li>dataframe</li>
</ol></section></section><section id="extracting-the-estimate-of-sigma-sigma" class="level3" data-number="10.2.2"><h3 data-number="10.2.2" class="anchored" data-anchor-id="extracting-the-estimate-of-sigma-sigma">
<span class="header-section-number">10.2.2</span> Extracting the Estimate of <span class="math inline">\(\sigma\)</span> <code>sigma()</code>
</h3>
<p>The residual standard error shown in the <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> output of a linear regression is the “best” estimate for the value of <span class="math inline">\(\sigma\)</span>. We can extract this value using the built-in <code><a href="https://rdrr.io/r/stats/sigma.html">sigma()</a></code> function and save it in an object for later use.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">penguin_lm</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = body_mass_g ~ flipper_length_mm, data = penguins)

Residuals:
     Min       1Q   Median       3Q      Max 
-1058.80  -259.27   -26.88   247.33  1288.69 

Coefficients:
                   Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)       -5780.831    305.815  -18.90   &lt;2e-16 ***
flipper_length_mm    49.686      1.518   32.72   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 394.3 on 340 degrees of freedom
  (2 observations deleted due to missingness)
Multiple R-squared:  0.759, Adjusted R-squared:  0.7583 
F-statistic:  1071 on 1 and 340 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguin_sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sigma.html">sigma</a></span><span class="op">(</span><span class="va">penguin_lm</span><span class="op">)</span></span>
<span><span class="va">penguin_sigma</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 394.2782</code></pre>
</div>
</div>
</section><section id="adding-errors-noise-to-predictions-rnorm" class="level3" data-number="10.2.3"><h3 data-number="10.2.3" class="anchored" data-anchor-id="adding-errors-noise-to-predictions-rnorm">
<span class="header-section-number">10.2.3</span> Adding Errors / Noise to Predictions <code>rnorm()</code>
</h3>
<p>As stated before, under a linear regression model, we can simulate data that we would have expected to come from this model, by adding normally distributed errors to the values predicted from the linear regression.</p>
<p>Thus, it is useful for us to write a function that adds Normally distributed errors to a vector, <code>x</code>, given the value of <code>sd</code> input. I’ve written one such function here:</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">noise</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">mean</span> <span class="op">=</span> <span class="fl">0</span>, <span class="va">sd</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, </span>
<span>            <span class="va">mean</span>, </span>
<span>            <span class="va">sd</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we can use this function to generate a new “fake” dataset with observations we would have expected to come from our linear regression. Note I’m storing these predictions in a <code>tibble()</code>, so that I can easily plot them later!</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sim_response</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>sim_body_mass_g <span class="op">=</span> <span class="fu">noise</span><span class="op">(</span><span class="va">penguin_predict</span>, </span>
<span>                                           sd <span class="op">=</span> <span class="va">penguin_sigma</span><span class="op">)</span></span>
<span>                   <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">sim_response</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 1
  sim_body_mass_g
            &lt;dbl&gt;
1           2701.
2           3422.
3           4070.
4           3339.
5           3911.
6           3792.</code></pre>
</div>
</div>
<section id="q2-normal-errors" class="level4 unnumbered check-in"><h4 class="unnumbered anchored" data-anchor-id="q2-normal-errors">Q2: Normal Errors</h4>
<p>What does a mean of 0 imply for the residuals?</p>
</section></section></section><section id="plotting-predictions" class="level2" data-number="10.3"><h2 data-number="10.3" class="anchored" data-anchor-id="plotting-predictions">
<span class="header-section-number">10.3</span> Plotting Predictions</h2>
<p>The best way to assess if / where there are differences between the simulated data and the observed data is through visualizations. We can do this in two ways, (1) visualizing the distribution of the responses, and (2) visualizing the relationship between the responses and the explanatory variables.</p>
<section id="distribution-of-responses" class="level3" data-number="10.3.1"><h3 data-number="10.3.1" class="anchored" data-anchor-id="distribution-of-responses">
<span class="header-section-number">10.3.1</span> Distribution of Responses</h3>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">obs_p</span> <span class="op">&lt;-</span> <span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">body_mass_g</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">350</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Observed Body Mass (g)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">""</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Count"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlim</span><span class="op">(</span><span class="fl">2500</span>, <span class="fl">6500</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">new_p</span> <span class="op">&lt;-</span> <span class="va">sim_response</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">sim_body_mass_g</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">350</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Simulated Body Mass (g)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">""</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Count"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlim</span><span class="op">(</span><span class="fl">2500</span>, <span class="fl">6500</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span></span>
<span><span class="va">obs_p</span> <span class="op">+</span> <span class="va">new_p</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="10-predictive-checks_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="q3-simulated-data-distribution" class="level4 unnumbered check-in"><h4 class="unnumbered anchored" data-anchor-id="q3-simulated-data-distribution">Q3: Simulated Data Distribution</h4>
<p>Are the simulated bill lengths similar or different from the observed bill lengths? Where do you see differences? Where do you see similarities? Would you conclude that both distributions could have come from the same data generating process?</p>
</section></section><section id="adding-in-the-observed-xs" class="level3" data-number="10.3.2"><h3 data-number="10.3.2" class="anchored" data-anchor-id="adding-in-the-observed-xs">
<span class="header-section-number">10.3.2</span> Adding in the Observed x’s</h3>
<p>If we are interested in seeing if the observed relationships between <code>flipper_length_mm</code> and <code>body_mass_g</code> are radically different from the simulated data, we need to add these variables into our simulated data set.</p>
<p>Remember, by default <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> throws out any observations with missing values (<code>NA</code>) for any of the variables included in the regression. Thus, we will have fewer predictions than observations in our data set. To make sure the predictions match up with their corresponding row, we need to filter the missing values out of the data set before we bind the columns together.</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sim_data</span> <span class="op">&lt;-</span> <span class="va">penguins</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">body_mass_g</span><span class="op">)</span>, </span>
<span>         <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">flipper_length_mm</span><span class="op">)</span></span>
<span>         <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">body_mass_g</span>, <span class="va">flipper_length_mm</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">bind_cols</span><span class="op">(</span><span class="va">sim_response</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">sim_data</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  body_mass_g flipper_length_mm sim_body_mass_g
        &lt;int&gt;             &lt;int&gt;           &lt;dbl&gt;
1        3750               181           2701.
2        3800               186           3422.
3        3250               195           4070.
4        3450               193           3339.
5        3650               190           3911.
6        3625               181           3792.</code></pre>
</div>
</div>
</section><section id="scatterplot-of-relationships" class="level3" data-number="10.3.3"><h3 data-number="10.3.3" class="anchored" data-anchor-id="scatterplot-of-relationships">
<span class="header-section-number">10.3.3</span> Scatterplot of Relationships</h3>
<p>A scatterplot of the relationships modeled by the linear regression can give a more detailed idea for where the simulated data differ from the observed data. In the scatterplots below, we see that the data simulated from the regression more closely follows a linear relationship, but there are not dramatic differences between the two scatterplots.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">obs_reg_p</span> <span class="op">&lt;-</span> <span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">body_mass_g</span>,</span>
<span>             x <span class="op">=</span> <span class="va">flipper_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Observed Body Mass"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Flipper Length (mm)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">""</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Body Mass (g)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_reg_p</span> <span class="op">&lt;-</span><span class="va">sim_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">sim_body_mass_g</span>,</span>
<span>             x <span class="op">=</span> <span class="va">flipper_length_mm</span><span class="op">)</span></span>
<span>         <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Simulated Body Mass \nbased on Regression Model"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Flipper Length (mm)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">""</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Body Mass (g)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">obs_reg_p</span> <span class="op">+</span> <span class="va">sim_reg_p</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="10-predictive-checks_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section></section><section id="assessing-predictions" class="level2" data-number="10.4"><h2 data-number="10.4" class="anchored" data-anchor-id="assessing-predictions">
<span class="header-section-number">10.4</span> Assessing Predictions</h2>
<p>We would expect that if the regression model is a good model for penguin body mass, then the simulated data should look similar to what was observed. We can compare the simulated data with the observed data using a scatterplot.</p>
<p>If the simulated data were identical to the observed data, they would all fall on the <span class="math inline">\(y = x\)</span> line (dashed blue). Values above the <span class="math inline">\(y = x\)</span> line correspond to simulated body masses larger than the observed body masses, and values below the line correspond to simulated body masses smaller than the observed body masses. Overall, it appears that there are about as many over estimates as underestimates. It appears there is a “moderate” relationship between the observed values and simulated values, as the points are fairly close to the line, but not extremely close.</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sim_data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">sim_body_mass_g</span>, </span>
<span>             y <span class="op">=</span> <span class="va">body_mass_g</span><span class="op">)</span></span>
<span>         <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>   <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Simulated Body Mass (g)"</span>, </span>
<span>        y <span class="op">=</span> <span class="st">""</span>,</span>
<span>        subtitle <span class="op">=</span> <span class="st">"Observed Body Mass (g)"</span> <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_abline</span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span>,</span>
<span>              intercept <span class="op">=</span> <span class="fl">0</span>, </span>
<span>              color <span class="op">=</span> <span class="st">"steelblue"</span>,</span>
<span>              linetype <span class="op">=</span> <span class="st">"dashed"</span>,</span>
<span>              lwd <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="10-predictive-checks_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can use a statistic to summarize how “close” the simulated values and the observed values are. We can use any statistic that captures the residuals from this regression. I like <span class="math inline">\(R^2,\)</span> since it has an easy reference value for what I would expect if my model did a good job (<span class="math inline">\(R^2 \approx 1\)</span>).</p>
<p>I like the <code>glance()</code> function from the <strong>broom</strong> package, since it produces a nice table output of the summary measures from a linear regression.</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">body_mass_g</span> <span class="op">~</span> <span class="va">sim_body_mass_g</span>, </span>
<span>   data <span class="op">=</span> <span class="va">sim_data</span></span>
<span>   <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">glance</span><span class="op">(</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">r.squared</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">adj.r.squared</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">sigma</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">statistic</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">p.value</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">df</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">logLik</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">AIC</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">BIC</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">deviance</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">df.residual</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">nobs</th>
</tr></thead>
<tbody><tr class="odd">
<td style="text-align: right;">0.553</td>
<td style="text-align: right;">0.552</td>
<td style="text-align: right;">536.778</td>
<td style="text-align: right;">421.14</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-2633.944</td>
<td style="text-align: right;">5273.888</td>
<td style="text-align: right;">5285.392</td>
<td style="text-align: right;">97964349</td>
<td style="text-align: right;">340</td>
<td style="text-align: right;">342</td>
</tr></tbody>
</table>
</div>
</div>
<p>I can then use the column names of the table to <code>select()</code> the <code>r.squared</code> column</p>
<div class="note">
<p>This would be a great place to use inline code to report the $R^2 value!</p>
</div>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sim_r2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">body_mass_g</span> <span class="op">~</span> <span class="va">sim_body_mass_g</span>, </span>
<span>             data <span class="op">=</span> <span class="va">sim_data</span></span>
<span>             <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">glance</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">r.squared</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">sim_r2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5533018</code></pre>
</div>
</div>
<section id="q4-interpreting-r2" class="level4 unnumbered check-in"><h4 class="unnumbered anchored" data-anchor-id="q4-interpreting-r2">Q4: Interpreting <span class="math inline">\(R^2\)</span>
</h4>
<p>What does the <span class="math inline">\(R^2\)</span> value of 0.553 for the above regression mean? How would you interpret it?</p>
</section></section><section id="iterating" class="level2" data-number="10.5"><h2 data-number="10.5" class="anchored" data-anchor-id="iterating">
<span class="header-section-number">10.5</span> Iterating!</h2>
<p>We are interested in seeing how our model performs for more than one simulated data set. Thus, we need to iterate through the process outlined above. Specifically, at each step we will need to:</p>
<ol type="1">
<li>Simulate new data</li>
<li>Regress the new data on the observed data</li>
<li>Save the <span class="math inline">\(R^2\)</span> from the regression</li>
</ol>
<section id="lots-of-simulated-observations" class="level3" data-number="10.5.1"><h3 data-number="10.5.1" class="anchored" data-anchor-id="lots-of-simulated-observations">
<span class="header-section-number">10.5.1</span> Lots of Simulated Observations</h3>
<p>Luckily, we have already written the <code>noise()</code> function that helps us simulate new observations that could have occurred under our model. Since we are not changing any input to <code>noise()</code>, we can choose between passing an “arbitrary” input to <code>map()</code> (e.g., <code>1:100</code>). This essentially rerun the same process multiple times. Since we want for every simulated data set to be bound together as columns, we can use the <code>map_dfc()</code> function!</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">nsims</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu">map_dfc</span><span class="op">(</span>.x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">nsims</span>,</span>
<span>                .f <span class="op">=</span> <span class="op">~</span> <span class="fu">tibble</span><span class="op">(</span>sim <span class="op">=</span> <span class="fu">noise</span><span class="op">(</span><span class="va">penguin_predict</span>, </span>
<span>                                          sd <span class="op">=</span> <span class="va">penguin_sigma</span><span class="op">)</span></span>
<span>                              <span class="op">)</span></span>
<span>                <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">sims</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 100
  sim...1 sim...2 sim...3 sim...4 sim...5 sim...6 sim...7 sim...8 sim...9
    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1   3330.   2653.   3087.   3150.   3129.   3859.   3454.   3088.   3262.
2   3446.   3754.   3335.   2994.   2989.   3979.   3456.   3929.   3401.
3   3904.   4197.   3450.   3582.   4103.   4317.   3666.   4069.   3626.
4   4445.   3608.   3342.   3672.   4412.   3510.   3543.   4393.   4261.
5   3356.   3924.   3464.   3581.   3304.   4460.   3600.   3877.   3568.
6   3100.   3072.   3534.   3054.   3006.   3769.   2769.   2546.   3224.
# ℹ 91 more variables: sim...10 &lt;dbl&gt;, sim...11 &lt;dbl&gt;, sim...12 &lt;dbl&gt;,
#   sim...13 &lt;dbl&gt;, sim...14 &lt;dbl&gt;, sim...15 &lt;dbl&gt;, sim...16 &lt;dbl&gt;,
#   sim...17 &lt;dbl&gt;, sim...18 &lt;dbl&gt;, sim...19 &lt;dbl&gt;, sim...20 &lt;dbl&gt;,
#   sim...21 &lt;dbl&gt;, sim...22 &lt;dbl&gt;, sim...23 &lt;dbl&gt;, sim...24 &lt;dbl&gt;,
#   sim...25 &lt;dbl&gt;, sim...26 &lt;dbl&gt;, sim...27 &lt;dbl&gt;, sim...28 &lt;dbl&gt;,
#   sim...29 &lt;dbl&gt;, sim...30 &lt;dbl&gt;, sim...31 &lt;dbl&gt;, sim...32 &lt;dbl&gt;,
#   sim...33 &lt;dbl&gt;, sim...34 &lt;dbl&gt;, sim...35 &lt;dbl&gt;, sim...36 &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>Since all of the columns have the same name, <code>dplyr</code> automatically adds <code>...</code> and a number after each column. So, our column names look like <code>sim...1</code>, <code>sim...2</code>, etc. It would be nice to replace the <code>...</code>s with a <code>_</code>, which our friend <code>str_replace_all()</code> can help us do! Remember, the <code>.</code> is a special character and needs to be escaped!</p>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">sims</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">sims</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">str_replace</span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"\\.\\.\\."</span>,</span>
<span>                  replace <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, we can add the observed response (<code>body_mass_g</code>) into our simulated data set, for ease of modeling and visualizing.</p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="va">penguins</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">body_mass_g</span><span class="op">)</span>, </span>
<span>         <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">flipper_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">body_mass_g</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">bind_cols</span><span class="op">(</span><span class="va">sims</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">sims</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 101
  body_mass_g sim_1 sim_2 sim_3 sim_4 sim_5 sim_6 sim_7 sim_8 sim_9 sim_10
        &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1        3750 3330. 2653. 3087. 3150. 3129. 3859. 3454. 3088. 3262.  3379.
2        3800 3446. 3754. 3335. 2994. 2989. 3979. 3456. 3929. 3401.  3845.
3        3250 3904. 4197. 3450. 3582. 4103. 4317. 3666. 4069. 3626.  3981.
4        3450 4445. 3608. 3342. 3672. 4412. 3510. 3543. 4393. 4261.  4222.
5        3650 3356. 3924. 3464. 3581. 3304. 4460. 3600. 3877. 3568.  4258.
6        3625 3100. 3072. 3534. 3054. 3006. 3769. 2769. 2546. 3224.  2885.
# ℹ 90 more variables: sim_11 &lt;dbl&gt;, sim_12 &lt;dbl&gt;, sim_13 &lt;dbl&gt;, sim_14 &lt;dbl&gt;,
#   sim_15 &lt;dbl&gt;, sim_16 &lt;dbl&gt;, sim_17 &lt;dbl&gt;, sim_18 &lt;dbl&gt;, sim_19 &lt;dbl&gt;,
#   sim_20 &lt;dbl&gt;, sim_21 &lt;dbl&gt;, sim_22 &lt;dbl&gt;, sim_23 &lt;dbl&gt;, sim_24 &lt;dbl&gt;,
#   sim_25 &lt;dbl&gt;, sim_26 &lt;dbl&gt;, sim_27 &lt;dbl&gt;, sim_28 &lt;dbl&gt;, sim_29 &lt;dbl&gt;,
#   sim_30 &lt;dbl&gt;, sim_31 &lt;dbl&gt;, sim_32 &lt;dbl&gt;, sim_33 &lt;dbl&gt;, sim_34 &lt;dbl&gt;,
#   sim_35 &lt;dbl&gt;, sim_36 &lt;dbl&gt;, sim_37 &lt;dbl&gt;, sim_38 &lt;dbl&gt;, sim_39 &lt;dbl&gt;,
#   sim_40 &lt;dbl&gt;, sim_41 &lt;dbl&gt;, sim_42 &lt;dbl&gt;, sim_43 &lt;dbl&gt;, sim_44 &lt;dbl&gt;, …</code></pre>
</div>
</div>
</section><section id="lots-of-regressions-r2-values" class="level3" data-number="10.5.2"><h3 data-number="10.5.2" class="anchored" data-anchor-id="lots-of-regressions-r2-values">
<span class="header-section-number">10.5.2</span> Lots of Regressions &amp; <span class="math inline">\(R^2\)</span> Values</h3>
<p>Now, we want to regress each of these simulated <code>body_mass_g</code>s on the original, observed <code>body_mass_g</code>. Again, we will need to iterate through this process.</p>
<p>Before, I fit a linear regression between <code>body_mass_g</code> and the simulated data. Now, I have 100 different datasets I need to regress on <code>body_mass_g</code>. I can use <code>map()</code> to define a function that will be applied to each column of <code>sims</code>. This function regresses <code>body_mass_g</code> on each column (<code>.x</code>) from the <code>sims</code> dataset.</p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sims</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">map</span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">body_mass_g</span> <span class="op">~</span> <span class="va">.x</span>, data <span class="op">=</span> <span class="va">sims</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="q5-mapping-linear-regression" class="level4 unnumbered check-in"><h4 class="unnumbered anchored" data-anchor-id="q5-mapping-linear-regression">Q5: Mapping Linear Regression</h4>
<p>What is the data structure of the values output after the <code>map(~lm(body_mass_g ~ .x, data = sims))</code> step?</p>
<ol type="a">
<li>list</li>
<li>vector</li>
<li>matrix</li>
<li>dataframe</li>
</ol></section><p>Next, I <code>map()</code> the <code>glance()</code> function onto each of these 100 regressions.</p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sims</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">map</span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">body_mass_g</span> <span class="op">~</span> <span class="va">.x</span>, data <span class="op">=</span> <span class="va">sims</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">map</span><span class="op">(</span><span class="va">glance</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="q6-mapping-linear-regression-summaries" class="level4 unnumbered check-in"><h4 class="unnumbered anchored" data-anchor-id="q6-mapping-linear-regression-summaries">Q6: Mapping Linear Regression Summaries</h4>
<p>What is the data structure of the values output after the <code>map(glance)</code> step?</p>
<ol type="a">
<li>list</li>
<li>vector</li>
<li>matrix</li>
<li>dataframe</li>
</ol></section><p>Finally, I use <code>map_dbl()</code> to extract the <code>r.squared</code> from each of the model fit summaries.</p>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sims</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">map</span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">body_mass_g</span> <span class="op">~</span> <span class="va">.x</span>, data <span class="op">=</span> <span class="va">sims</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">map</span><span class="op">(</span><span class="va">glance</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">map_dbl</span><span class="op">(</span><span class="op">~</span> <span class="va">.x</span><span class="op">$</span><span class="va">r.squared</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="q7-mapping-regression-summaries" class="level4 unnumbered check-in"><h4 class="unnumbered anchored" data-anchor-id="q7-mapping-regression-summaries">Q7: Mapping Regression Summaries</h4>
<p>What is the data structure of the values output after the <code>map_dbl(~.$r.squared)</code> step?</p>
<ol type="a">
<li>list</li>
<li>vector</li>
<li>matrix</li>
<li>dataframe</li>
</ol></section></section><section id="inspecting-the-r2-values" class="level3" data-number="10.5.3"><h3 data-number="10.5.3" class="anchored" data-anchor-id="inspecting-the-r2-values">
<span class="header-section-number">10.5.3</span> Inspecting the <span class="math inline">\(R^2\)</span> Values</h3>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sim_r_sq</span> <span class="op">&lt;-</span> <span class="va">sims</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">map</span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">body_mass_g</span> <span class="op">~</span> <span class="va">.x</span>, data <span class="op">=</span> <span class="va">sims</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">map</span><span class="op">(</span><span class="va">glance</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">map_dbl</span><span class="op">(</span><span class="op">~</span> <span class="va">.x</span><span class="op">$</span><span class="va">r.squared</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If I look at the first six <span class="math inline">\(R^2\)</span> values, I see that the first value corresponds to the the following regression: <code>lm(body_mass_g ~ body_mass_g)</code></p>
<p>All of the values thereafter are the <span class="math inline">\(R^2\)</span> values from the simulated data.</p>
<div class="cell">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">sim_r_sq</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>body_mass_g       sim_1       sim_2       sim_3       sim_4       sim_5 
  1.0000000   0.5896863   0.5753450   0.5819932   0.5725102   0.5705712 </code></pre>
</div>
</div>
<p>I am interested in looking at the distribution of <span class="math inline">\(R^2\)</span> values from the simulated data, so I’m going to remove this unwanted entry of the <code>sim_r_sq</code> vector.</p>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sim_r_sq</span> <span class="op">&lt;-</span> <span class="va">sim_r_sq</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">sim_r_sq</span><span class="op">)</span> <span class="op">!=</span> <span class="st">"body_mass_g"</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="plotting-the-simulated-r2-values-versus-the-observed-r2" class="level3" data-number="10.5.4"><h3 data-number="10.5.4" class="anchored" data-anchor-id="plotting-the-simulated-r2-values-versus-the-observed-r2">
<span class="header-section-number">10.5.4</span> Plotting the Simulated <span class="math inline">\(R^2\)</span> Values versus the Observed <span class="math inline">\(R^2\)</span>
</h3>
<p>The final stage is to plot the statistics from the simulated data. The distribution of these <span class="math inline">\(R^2\)</span> values will tell if our assumed model does a good job of producing data similar to what was observed. If the model produces data similar to what was observed, we would expect <span class="math inline">\(R^2\)</span> values near 1.</p>
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">tibble</span><span class="op">(</span>sims <span class="op">=</span> <span class="va">sim_r_sq</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">sims</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">0.025</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="st">"Simulated"</span><span class="op">~</span> <span class="va">R</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>       y <span class="op">=</span> <span class="st">""</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Number of Simulated Models"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="10-predictive-checks_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>In this plot, we see that the simulated datasets have <span class="math inline">\(R^2\)</span> vales between 0.5 and 0.65. This indicates the data simulated under this statistical model <strong>are moderately</strong> similar to what was observed. On average, our simulated data account for about 57.7% of the variability in the observed penguin body mass.</p>
</section></section><section id="references" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="references">References</h2>


<div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-gelman_2014" class="csl-entry" role="listitem">
Gelman, Andrew. 2014. <span>“Model Checking.”</span> In <em>Bayesian Data Analysis</em>. CRC Press.
</div>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./09-statistical-modeling-and-simulation.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Regression &amp; Simulating Distributions</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->



</body></html>